<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dynamic Weather Dashboard</title>
  <style>
    /* ---------- Theme & Reset ---------- */
    :root{
      --bg-1:#071021;
      --bg-2:#0b1830;
      --card: rgba(20,30,48,0.68);
      --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.06);
      --accent: #ffc300;
      --muted: rgba(255,255,255,0.78);
      --radius: 16px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html{font-size:16px}
    body{
      min-height:100vh;
      background:linear-gradient(180deg,var(--bg-1) 0%, var(--bg-2) 70%);
      color:white;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      overflow:hidden;
    }

    /* ---------- Startup Screen ---------- */
    #startupScreen{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      position:absolute;
      inset:0;
      background:var(--bg-1);
      z-index:100;
      transition: opacity 0.8s ease, visibility 0.8s;
    }
    #startupScreen.hidden{
      opacity:0;
      visibility:hidden;
      pointer-events:none;
    }
    .startup-title{
      font-size:2.5rem;
      font-weight:800;
      letter-spacing:-1px;
      margin-bottom:12px;
      animation:fadeInUp 1s ease both;
    }
    .startup-prompt{
      font-size:1.1rem;
      color:var(--muted);
      margin-bottom:24px;
      animation:fadeInUp 1s 0.2s ease both;
    }
    .startup-search{
      display:flex;
      gap:8px;
      width:90%;
      max-width:400px;
      animation:fadeInUp 1s 0.4s ease both;
    }
    #startupCityInput{
      flex:1;
      padding:14px 18px;
      border-radius:50px;
      border:1px solid var(--glass-2);
      background:rgba(255,255,255,0.05);
      color:white;
      outline:none;
      font-size:16px;
      transition:border-color 0.3s;
    }
    #startupCityInput:focus{
      border-color:var(--accent);
    }
    #startupSearchBtn{
      border:none;
      cursor:pointer;
      border-radius:50%;
      width:50px;
      height:50px;
      font-weight:600;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      background:var(--accent);
      color:#071021;
      transition:transform 0.2s;
    }
    #startupSearchBtn:active{transform:scale(0.95)}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}


    /* ---------- App Shell ---------- */
    .app{
      width:100%;
      max-width:1200px;
      height:92vh;
      max-height:820px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:18px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      box-shadow:0 14px 48px rgba(0,0,0,0.6);
      backdrop-filter: blur(10px);
      position:relative;
      overflow:hidden;
    }

    /* ---------- Left Panel ---------- */
    .panel{
      background:var(--card);
      padding:18px;
      border-radius:12px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
    }
    .search-row{display:flex;gap:8px;align-items:center}
    input[type=text]{
      flex:1;padding:12px;border-radius:10px;border:1px solid var(--glass);
      background:rgba(255,255,255,0.03);color:var(--muted);outline:none;font-size:14px;
    }
    input[type=text]:focus{border-color:var(--accent)}
    button{
      border:none;cursor:pointer;border-radius:10px;padding:10px 12px;font-weight:600;
      display:inline-flex;align-items:center;justify-content:center;
    }
    #searchBtn{background:var(--accent);color:#071021}
    button:active{transform:scale(0.97)}
    .location{font-size:18px;font-weight:700}
    .updated{font-size:12px;color:rgba(255,255,255,0.6);margin-top:4px}

    .current-weather{display:flex;gap:12px;align-items:center;margin-top:6px}
    .icon{width:74px;height:74px;display:flex;align-items:center;justify-content:center}
    .big-temp{font-size:56px;font-weight:800;line-height:1}
    .conds{font-size:15px;color:var(--muted)}
    .small-stat{font-size:13px;color:rgba(255,255,255,0.85)}

    .scrollable-forecast{
      display:flex;gap:10px;margin-top:12px;padding-bottom:8px;overflow-x:auto;
      scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch;
    }
    .forecast-item{
      flex:0 0 auto;min-width:84px;background:var(--glass-2);padding:10px;border-radius:10px;
      text-align:center;scroll-snap-align:start;
    }
    .forecast-item .label{font-weight:700;margin-bottom:6px}

    /* ---------- Right Panel ---------- */
    .main{
      padding:18px;border-radius:12px;display:flex;flex-direction:column;overflow:auto;
      min-height:0;
    }
    .header-row{display:flex;justify-content:space-between;align-items:center}
    h2, h3{font-size:20px}
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap:12px;
      margin-top:12px;
    }
    .metric{
      background:var(--glass);padding:12px;border-radius:10px;text-align:center;
    }
    .metric .num{font-size:20px;font-weight:700}
    .metric .lab{font-size:12px;color:var(--muted);margin-top:6px}
    
    /* MODIFIED Styles for Columnar Daily Forecast */
    .daily-forecast-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }
    .daily-forecast-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--glass-2);
      padding: 8px 12px;
      border-radius: 10px;
      transition: background 0.4s ease, transform 0.2s ease;
    }
    .daily-forecast-item:hover {
        transform: scale(1.02);
    }
    .day-details { flex: 1.5; text-align: left; }
    .daily-forecast-item > img { flex: 0.5; text-align: center; }
    .day-temp { flex: 1; text-align: right; font-weight: 700; font-size: 15px; }
    .day-name { font-weight: 700; }
    .day-condition { font-size: 12px; color: var(--muted); font-weight: 500; }
    
    /* NEW Dynamic Backgrounds */
    .daily-forecast-item.weather-sunny { background: linear-gradient(135deg, rgba(255, 195, 0, 0.18), var(--glass-2)); }
    .daily-forecast-item.weather-cloudy { background: linear-gradient(135deg, rgba(150, 160, 170, 0.18), var(--glass-2)); }
    .daily-forecast-item.weather-rain { background: linear-gradient(135deg, rgba(0, 110, 255, 0.18), var(--glass-2)); }
    .daily-forecast-item.weather-storm { background: linear-gradient(135deg, rgba(70, 0, 150, 0.22), var(--glass-2)); }
    .daily-forecast-item.weather-snow { background: linear-gradient(135deg, rgba(200, 220, 255, 0.18), var(--glass-2)); }


    #effects{position:absolute;inset:0;pointer-events:none;border-radius:var(--radius)}
    .flash{position:absolute;inset:0;background:#fff;opacity:0;pointer-events:none;z-index:10}

    .loader{width:22px;height:22px;border-radius:50%;
      border:3px solid rgba(255,255,255,0.12);border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* ---------- Responsive Design & Accessibility ---------- */
    @media (max-width:1024px){
      body{overflow:auto}
      .app{grid-template-columns: 1fr; height:auto; max-height:none}
    }
    @media (max-width:600px){
      body{padding:0}
      .app{height:auto;border-radius:0}
      .panel, .main{padding:14px; border-radius:0;}
      .big-temp{font-size:44px}
      .search-row input[type=text]{padding:10px;font-size:14px}
      #searchBtn{padding:8px}
      .grid{grid-template-columns:repeat(2,1fr)}
      .forecast-item{min-width:72px}
      .startup-title{font-size:2rem}
      .startup-prompt{font-size:1rem}
    }

    @media (prefers-reduced-motion: reduce){
      *{animation:none!important;transition:none!important}
    }

    .scrollable-forecast::-webkit-scrollbar, .main::-webkit-scrollbar{height:8px;width:8px}
    .scrollable-forecast::-webkit-scrollbar-thumb, .main::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.06);border-radius:20px}
  </style>
</head>
<body>
  <div id="startupScreen">
    <h1 class="startup-title">Weather Dashboard</h1>
    <p class="startup-prompt">Enter a city to get the latest weather forecast</p>
    <div class="startup-search">
      <input id="startupCityInput" type="text" placeholder="Search City" aria-label="City input" />
      <button id="startupSearchBtn" title="Search">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      </button>
    </div>
  </div>

  <div class="app" role="application" aria-label="Dynamic Weather Dashboard">
    <canvas id="effects" aria-hidden="true"></canvas>
    <div class="panel" aria-live="polite">
      <div class="search-row">
        <input id="cityInput" type="text" placeholder="Search City" aria-label="City input for new search" />
        <button id="searchBtn" title="Search">Search</button>
      </div>

      <div id="weather-content">
        <div class="location" id="location">â€”</div>
        <div class="updated" id="updated">Enter a city to begin</div>

        <div class="current-weather" role="region" aria-label="Current weather">
          <div class="icon" id="weatherIcon" aria-hidden="true"></div>
          <div>
            <div class="big-temp" id="temp">--Â°C</div>
            <div class="conds" id="condition">â€”</div>
            <div class="small-stat" id="feels">Feels like: â€”</div>
          </div>
        </div>
      </div>
      <div class="flash" id="flash" aria-hidden="true"></div>
    </div>

    <div class="main">
      <div class="header-row">
        <h2>Details</h2>
        <div id="loader" class="loader" style="display:none" aria-hidden="true"></div>
      </div>

      <p id="summary" style="color:var(--muted);margin-top:8px">Waiting for input...</p>

      <div class="grid" role="list" aria-label="Weather metrics" style="margin-top:16px">
        <div class="metric" role="listitem"><div class="num" id="wind">â€”</div><div class="lab">Wind</div></div>
        <div class="metric" role="listitem"><div class="num" id="humidity">â€”</div><div class="lab">Humidity</div></div>
        <div class="metric" role="listitem"><div class="num" id="pressure">â€”</div><div class="lab">Pressure</div></div>
        <div class="metric" role="listitem"><div class="num" id="uv">â€”</div><div class="lab">UV Index</div></div>
        <div class="metric" role="listitem"><div class="num" id="vis">â€”</div><div class="lab">Visibility</div></div>
        <div class="metric" role="listitem"><div class="num" id="aqi">â€”</div><div class="lab">AQI (PM2.5)</div></div>
      </div>

      <h3 style="margin-top:16px; font-size:16px;">Today's Hourly Forecast</h3>
      <div class="scrollable-forecast" id="hourlyForecast" aria-label="Hourly forecast"></div>
      
      <h3 style="margin-top:16px; font-size:16px;">3-Days Forecast</h3>
      <div id="forecast" class="daily-forecast-list" aria-label="3 day forecast"></div>

      <div style="margin-top:14px">
        <strong>Tips:</strong>
        <ul style="margin-top:6px;color:var(--muted);padding-left:18px">
          <li id="advice">â€”</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    const API_KEY = 'c6015299029641ef806133911251909';
    const BASE = 'https://api.weatherapi.com/v1/forecast.json';

    // Element selectors
    const startupScreen = document.getElementById('startupScreen');
    const startupCityInput = document.getElementById('startupCityInput');
    const startupSearchBtn = document.getElementById('startupSearchBtn');
    const cityInput = document.getElementById('cityInput');
    const searchBtn = document.getElementById('searchBtn');
    const locationEl = document.getElementById('location');
    const updatedEl = document.getElementById('updated');
    const tempEl = document.getElementById('temp');
    const conditionEl = document.getElementById('condition');
    const feelsEl = document.getElementById('feels');
    const forecastEl = document.getElementById('forecast');
    const hourlyForecastEl = document.getElementById('hourlyForecast');
    const weatherIconEl = document.getElementById('weatherIcon');
    const summaryEl = document.getElementById('summary');
    const loaderEl = document.getElementById('loader');
    const windEl = document.getElementById('wind');
    const humidityEl = document.getElementById('humidity');
    const pressureEl = document.getElementById('pressure');
    const uvEl = document.getElementById('uv');
    const visEl = document.getElementById('vis');
    const aqiEl = document.getElementById('aqi');
    const adviceEl = document.getElementById('advice');
    const flashEl = document.getElementById('flash');
    const canvas = document.getElementById('effects');
    const ctx = canvas.getContext('2d');

    let w = 0, h = 0;
    function resizeCanvas(){
      const dpr = window.devicePixelRatio || 1;
      const app = document.querySelector('.app');
      w = app.clientWidth;
      h = app.clientHeight;
      canvas.width = Math.max(300, Math.floor(w * dpr));
      canvas.height = Math.max(200, Math.floor(h * dpr));
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(dpr, dpr);
    }
    window.addEventListener('resize', resizeCanvas);

    async function fetchWeather(q){
      try{
        loaderEl.style.display = 'block';
        const url = `${BASE}?key=${API_KEY}&q=${encodeURIComponent(q)}&days=3&aqi=yes&alerts=no`;
        const res = await fetch(url);
        if(!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.error.message || 'Network response not ok');
        }
        const data = await res.json();
        startupScreen.classList.add('hidden');
        renderWeather(data);
      }catch(err){
        alert(`Could not fetch weather: ${err.message}. Please check the city name and your connection.`);
        console.error(err);
      }finally{
        loaderEl.style.display = 'none';
      }
    }

    // NEW helper function to map weather codes to CSS classes
    function getWeatherClass(code) {
        // Codes list from WeatherAPI documentation
        const sunny = [1000];
        const cloudy = [1003, 1006, 1009, 1030, 1135, 1147];
        const rain = [1063, 1072, 1150, 1153, 1168, 1171, 1180, 1183, 1186, 1189, 1192, 1195, 1198, 1201, 1240, 1243, 1246, 1249, 1252];
        const storm = [1087, 1273, 1276];
        const snow = [1066, 1069, 1114, 1117, 1204, 1207, 1210, 1213, 1216, 1219, 1222, 1225, 1237, 1255, 1258, 1261, 1264, 1279, 1282];

        if (sunny.includes(code)) return 'weather-sunny';
        if (storm.includes(code)) return 'weather-storm';
        if (rain.includes(code)) return 'weather-rain';
        if (snow.includes(code)) return 'weather-snow';
        if (cloudy.includes(code)) return 'weather-cloudy';
        return ''; // Default
    }

    function renderWeather(d){
      const { location, current, forecast } = d;
      locationEl.textContent = `${location.name}, ${location.region || location.country}`;
      updatedEl.textContent = `Updated: ${current.last_updated}`;
      tempEl.textContent = `${Math.round(current.temp_c)}Â°C`;
      conditionEl.textContent = current.condition.text;
      feelsEl.textContent = `Feels like ${Math.round(current.feelslike_c)}Â°C`;
      cityInput.value = location.name;

      summaryEl.textContent = `Today: ${forecast.forecastday[0].day.condition.text}. High ${Math.round(forecast.forecastday[0].day.maxtemp_c)}Â°C, Low ${Math.round(forecast.forecastday[0].day.mintemp_c)}Â°C.`;

      windEl.textContent = `${current.wind_kph} kph`;
      humidityEl.textContent = `${current.humidity}%`;
      pressureEl.textContent = `${current.pressure_mb} mb`;
      uvEl.textContent = `${current.uv}`;
      visEl.textContent = `${current.vis_km} km`;
      aqiEl.textContent = current.air_quality ? Math.round(current.air_quality.pm2_5) : 'N/A';
      
      // MODIFIED: Render Daily Forecast with dynamic classes and more info
      forecastEl.innerHTML = '';
      forecast.forecastday.forEach(fd => {
        const dayName = new Date(fd.date).toLocaleDateString(undefined, { weekday: 'short' });
        const el = document.createElement('div');
        el.className = `daily-forecast-item ${getWeatherClass(fd.day.condition.code)}`;
        el.innerHTML = `
            <div class="day-details">
                <div class="day-name">${dayName}</div>
                <div class="day-condition">${fd.day.condition.text}</div>
            </div>
            <img src="https:${fd.day.condition.icon}" alt="${fd.day.condition.text}" width="40" height="40">
            <div class="day-temp">${Math.round(fd.day.maxtemp_c)}Â° / ${Math.round(fd.day.mintemp_c)}Â°</div>`;
        forecastEl.appendChild(el);
      });

      // Render Hourly Forecast
      hourlyForecastEl.innerHTML = '';
      const currentHour = new Date().getHours();
      forecast.forecastday[0].hour.forEach(hr => {
        const hour = parseInt(hr.time.split(' ')[1].split(':')[0]);
        if (hour >= currentHour) {
          const el = document.createElement('div');
          el.className = 'forecast-item';
          el.innerHTML = `<div class="label">${hour}:00</div>
                          <img src="https:${hr.condition.icon}" alt="${hr.condition.text}" width="40" height="40">
                          <div style="font-weight:700;margin-top:6px">${Math.round(hr.temp_c)}Â°C</div>`;
          hourlyForecastEl.appendChild(el);
        }
      });

      const adv = [];
      if(current.uv > 6) adv.push('High UV index. Wear sunscreen.');
      if(current.wind_kph > 40) adv.push('Strong winds. Be careful outside.');
      if(current.temp_c <= 5) adv.push('It\'s cold. Wear warm layers.');
      if(current.temp_c >= 30) adv.push('Hot day. Stay hydrated.');
      if(current.condition.text.toLowerCase().includes('rain')) adv.push('Carry an umbrella.');
      adviceEl.textContent = adv.length ? adv.join(' ') : 'Enjoy your day!';

      setIconAndEffects(d);
    }

    function setIconAndEffects(data){
      const cond = data.current.condition.text.toLowerCase();
      const code = data.current.condition.code;
      weatherIconEl.innerHTML = `<img src="https:${data.current.condition.icon}" alt="${cond}" width="74" height="74">`;

      const flags = { rain:false, snow:false, wind:false, lightning:false, cloud:false };
      if(cond.includes('rain') || cond.includes('drizzle')) flags.rain = true;
      if(cond.includes('snow') || cond.includes('sleet') || cond.includes('blizzard')) flags.snow = true;
      if(cond.includes('thunder')) { flags.lightning = true; flags.rain = true; }
      if(data.current.wind_kph > 25) flags.wind = true;
      if([1003,1006,1009].includes(code) || cond.includes('mist') || cond.includes('fog') || cond.includes('overcast')) flags.cloud = true;

      startEffects(flags);
    }

    let particles = [];
    let raf;
    let lightningTimer = null;

    function startEffects(flags){
      cancelAnimationFrame(raf);
      particles = [];
      resizeCanvas();
      const windSpeed = flags.wind ? 1.6 : 0.25;

      if(flags.rain) for(let i=0;i<160;i++) particles.push(new Drop(windSpeed));
      if(flags.snow) for(let i=0;i<120;i++) particles.push(new Snow(windSpeed));
      if(flags.cloud) for(let i=0;i<18;i++) particles.push(new CloudParticle());
      if(flags.lightning) startLightning(); else stopLightning();

      if(particles.length) animLoop();
      else ctx.clearRect(0,0,canvas.width,canvas.height);
    }

    function Particle(){ this.x = Math.random() * w; this.y = Math.random() * h; }
    function Drop(wind){ this.base = new Particle(); this.len = 6 + Math.random()*14; this.vy = 4 + Math.random()*6; this.vx = wind * (1 + Math.random()); this.draw = function(){ ctx.beginPath(); ctx.moveTo(this.base.x, this.base.y); ctx.lineTo(this.base.x + this.vx, this.base.y + this.len); ctx.stroke(); } }
    function Snow(wind){ this.base = new Particle(); this.r = 1 + Math.random()*3; this.vy = 0.3 + Math.random()*1.1; this.vx = wind * (Math.random() - 0.5); this.draw = function(){ ctx.beginPath(); ctx.arc(this.base.x, this.base.y, this.r, 0, Math.PI*2); ctx.fill(); } }
    function CloudParticle(){ this.base = new Particle(); this.base.y = h; this.r = 18 + Math.random()*30; this.vy = -(0.06 + Math.random()*0.28); this.vx = Math.random()*0.3 - 0.15; this.alpha = 0.02 + Math.random()*0.06; this.draw = function(){ ctx.fillStyle = `rgba(255,255,255,${this.alpha})`; ctx.beginPath(); ctx.arc(this.base.x, this.base.y, this.r, 0, Math.PI*2); ctx.fill(); } }

    function animLoop(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.lineWidth = 1.2;
      ctx.strokeStyle = 'rgba(255,255,255,0.22)';
      ctx.fillStyle = 'rgba(255,255,255,0.45)';
      for(let p of particles){
        if(p.base){
          p.base.x += (p.vx || 0);
          p.base.y += (p.vy || 0);
          if(p instanceof CloudParticle){ if(p.base.y + p.r < -20){ p.base.y = h + p.r + Math.random()*40; p.base.x = Math.random() * w; } }
          else { if(p.base.y > h + 30){ p.base.x = Math.random() * w; p.base.y = -40 - Math.random()*100; } }
          if(p.base.x > w + 40) p.base.x = -40;
          if(p.base.x < -40) p.base.x = w + 40;
        }
        p.draw();
      }
      raf = requestAnimationFrame(animLoop);
    }

    function startLightning(){
      if(lightningTimer) return;
      lightningTimer = setInterval(()=>{
        flashEl.style.transition = 'opacity 0.05s linear';
        flashEl.style.opacity = 0.9;
        setTimeout(()=>{ flashEl.style.transition = 'opacity 0.6s linear'; flashEl.style.opacity = 0; }, 100 + Math.random()*200);
      }, 3500 + Math.random()*5000);
    }
    function stopLightning(){ if(lightningTimer){ clearInterval(lightningTimer); lightningTimer = null; flashEl.style.opacity = 0; } }

    function handleSearch() {
      const input = startupScreen.classList.contains('hidden') ? cityInput : startupCityInput;
      const v = input.value.trim();
      if (v) {
        fetchWeather(v);
      } else {
        alert('Please enter a city name.');
      }
    }

    searchBtn.addEventListener('click', handleSearch);
    cityInput.addEventListener('keypress', (e)=>{ if(e.key === 'Enter') handleSearch(); });
    startupSearchBtn.addEventListener('click', handleSearch);
    startupCityInput.addEventListener('keypress', (e)=>{ if(e.key === 'Enter') handleSearch(); });


    document.addEventListener('DOMContentLoaded', ()=>{
      resizeCanvas();
      setTimeout(resizeCanvas, 500);
    });

    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) cancelAnimationFrame(raf); else if(particles.length) animLoop(); });
    document.querySelector('.app').addEventListener('dblclick', ()=>cityInput.focus());

  </script>
</body>
</html>