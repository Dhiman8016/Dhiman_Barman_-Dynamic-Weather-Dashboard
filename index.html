<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dynamic Weather Dashboard</title>
  <style>
    /* ---------- Theme & Reset ---------- */
    :root{
      --bg-1:#071021;
      --bg-2:#0b1830;
      --card: rgba(20,30,48,0.68);
      --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.06);
      --accent: #ffc300;
      --muted: rgba(255,255,255,0.78);
      --radius: 16px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html{font-size:16px}
    body{
      min-height:100vh;
      background:linear-gradient(180deg,var(--bg-1) 0%, var(--bg-2) 70%);
      color:white;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      overflow:auto;
    }

    /* ---------- Welcome Screen ---------- */
    #welcome-screen {
        position: fixed;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: linear-gradient(45deg, #071021, #0b1830, #2c3e50, #071021);
        background-size: 400% 400%;
        z-index: 100;
        transition: opacity 0.8s ease-out, visibility 0.8s;
        padding: 16px;
        text-align: center;
        animation: bg-pan 15s ease infinite;
    }

    @keyframes bg-pan {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    #welcome-screen h1 {
        font-size: clamp(2rem, 5vw, 3rem);
        font-weight: 800;
        color: #fff;
        margin-bottom: 8px;
        text-shadow: 0 0 15px rgba(255, 195, 0, 0.6);
    }

    #welcome-screen p {
        font-size: 1.1rem;
        color: var(--muted);
        margin-bottom: 24px;
    }

    #welcome-screen .search-row {
        max-width: 400px;
        width: 100%;
        display:flex;
        gap:8px;
        align-items:center;
    }

    .hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
    }

    /* ---------- App Shell ---------- */
    .app{
      width:100%;
      max-width:1200px;
      height:92vh;
      max-height:820px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:18px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      box-shadow:0 14px 48px rgba(0,0,0,0.6);
      backdrop-filter: blur(10px);
      position:relative;
      overflow:hidden;
      transition: opacity 0.8s ease-in, transform 0.8s ease-in;
    }
    .app.hidden {
        opacity: 0;
        transform: scale(0.95);
    }

    /* ---------- Left Panel ---------- */
    .panel{
      background:var(--card);
      padding:18px;
      border-radius:12px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
      overflow: auto;
    }
    .search-row{display:flex;gap:8px;align-items:center}
    input[type=text]{
      flex:1;padding:12px;border-radius:10px;border:1px solid var(--glass);
      background:rgba(255,255,255,0.03);color:var(--muted);outline:none;font-size:14px;
    }
    input[type=text]:focus{border-color:var(--accent)}
    button{
      border:none;cursor:pointer;border-radius:10px;padding:10px 12px;font-weight:600;
      display:inline-flex;align-items:center;justify-content:center;
    }
    #searchBtn{background:var(--accent);color:#071021}
    button:active{transform:scale(0.97)}
    .location{font-size:18px;font-weight:700}
    .updated{font-size:12px;color:rgba(255,255,255,0.6);margin-top:4px}

    .current-weather{display:flex;gap:12px;align-items:center;margin-top:6px}
    .icon{width:74px;height:74px;display:flex;align-items:center;justify-content:center}
    .big-temp{font-size:56px;font-weight:800;line-height:1}
    .conds{font-size:15px;color:var(--muted)}
    .small-stat{font-size:13px;color:rgba(255,255,255,0.85)}

    /* ---------- Right Panel ---------- */
    .main{
      padding:18px;border-radius:12px;display:flex;flex-direction:column;overflow:auto;
      min-height:0;
    }
    .header-row{display:flex;justify-content:space-between;align-items:center}
    h2{font-size:20px}
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap:12px;
      margin-top:12px;
    }
    .metric{
      background:var(--glass);padding:12px;border-radius:10px;text-align:center;
    }
    .metric .num{font-size:20px;font-weight:700}
    .metric .lab{font-size:12px;color:var(--muted);margin-top:6px}

    /* Hourly Forecast (Horizontal Scroll) */
    .forecast{
      display:flex;gap:10px;margin-top:12px;padding-bottom:8px;overflow-x:auto;
      scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch;
    }
    .forecast .day{
      flex:0 0 auto;min-width:84px;background:var(--glass-2);padding:10px;border-radius:10px;
      text-align:center;scroll-snap-align:start;
    }
    .forecast .day .d{font-weight:700;margin-bottom:6px}

    /* Daily Forecast (Vertical Rows) */
    .daily-forecast-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }
    .day-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--glass);
      padding: 8px 12px;
      border-radius: 10px;
    }
    .day-row .day-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .day-row .day-name {
      font-weight: 600;
      width: 100px;
      flex-shrink: 0;
    }
    .day-row .day-temp {
      font-weight: 700;
    }


    #effects{position:absolute;inset:0;pointer-events:none;border-radius:var(--radius)}

    .loader{width:22px;height:22px;border-radius:50%;
      border:3px solid rgba(255,255,255,0.12);border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    @media (max-width:1024px){
      body{padding:0}
      .app{grid-template-columns: 1fr; height:100vh; max-height:none; border-radius:0;}
      .panel, .main{border-radius:0}
    }
    @media (max-width:600px){
      .app{height:auto;border-radius:0}
      .panel{padding:14px}
      .main{padding:14px}
      .big-temp{font-size:44px}
      .search-row input[type=text]{padding:10px;font-size:14px}
      #searchBtn{padding:8px}
      .grid{grid-template-columns:repeat(2,1fr)}
      .forecast .day{min-width:72px}
      .day-row .day-name {width: 80px; font-size:14px;}
    }

    @media (prefers-reduced-motion: reduce){
      *{animation:none!important;transition:none!important}
    }

    .forecast::-webkit-scrollbar, .main::-webkit-scrollbar, .panel::-webkit-scrollbar{height:8px;width:8px}
    .forecast::-webkit-scrollbar-thumb, .main::-webkit-scrollbar-thumb, .panel::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.06);border-radius:20px}
  </style>
</head>
<body>

  <div id="welcome-screen">
      <h1>Weather Dashboard</h1>
      <p>Your live forecast, one search away.</p>
      <div class="search-row">
          <input id="cityInput" type="text" placeholder="Search City" aria-label="City input" />
          <button id="searchBtn" title="Search">Search</button>
      </div>
  </div>

  <div class="app hidden" role="application" aria-label="Dynamic Weather Dashboard">
    <canvas id="effects" aria-hidden="true"></canvas>
    <div class="panel" aria-live="polite">
      <div id="weather-content">
        <div class="location" id="location">—</div>
        <div class="updated" id="updated">No data yet</div>

        <div class="current-weather" role="region" aria-label="Current weather">
          <div class="icon" id="weatherIcon" aria-hidden="true"></div>
          <div>
            <div class="big-temp" id="temp">--°C</div>
            <div class="conds" id="condition">—</div>
            <div class="small-stat" id="feels">Feels like: —</div>
          </div>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="header-row">
        <h2>Details</h2>
        <div id="loader" class="loader" style="display:none" aria-hidden="true"></div>
      </div>
      <p id="summary" style="color:var(--muted);margin-top:8px">Fetching your live weather...</p>
      <div class="grid" role="list" aria-label="Weather metrics" style="margin-top:12px">
        <div class="metric" role="listitem"><div class="num" id="wind">—</div><div class="lab">Wind</div></div>
        <div class="metric" role="listitem"><div class="num" id="humidity">—</div><div class="lab">Humidity</div></div>
        <div class="metric" role="listitem"><div class="num" id="pressure">—</div><div class="lab">Pressure</div></div>
        <div class="metric" role="listitem"><div class="num" id="uv">—</div><div class="lab">UV Index</div></div>
        <div class="metric" role="listitem"><div class="num" id="vis">—</div><div class="lab">Visibility</div></div>
        <div class="metric" role="listitem"><div class="num" id="aqi">—</div><div class="lab">AQI (PM2.5)</div></div>
      </div>
      
      <h2 style="margin-top:24px">Today's Forecast</h2>
      <div class="forecast" id="hourly-forecast" aria-label="Hourly forecast for today"></div>
      
      <h2 style="margin-top:24px">Next 3 Days</h2>
      <div id="daily-forecast" aria-label="3 day forecast"></div>

      <div style="margin-top:24px">
        <strong>Tips:</strong>
        <ul style="margin-top:6px;color:var(--muted);padding-left:18px">
          <li id="advice">—</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    const API_KEY = 'c6015299029641ef806133911251909';
    const BASE = 'https://api.weatherapi.com/v1/forecast.json';

    // UI Elements
    const welcomeScreen = document.getElementById('welcome-screen');
    const appContainer = document.querySelector('.app');
    const panel = document.querySelector('.panel');
    const searchRow = document.querySelector('.search-row');
    const cityInput = document.getElementById('cityInput');
    const searchBtn = document.getElementById('searchBtn');
    const locationEl = document.getElementById('location');
    const updatedEl = document.getElementById('updated');
    const tempEl = document.getElementById('temp');
    const conditionEl = document.getElementById('condition');
    const feelsEl = document.getElementById('feels');
    const hourlyForecastEl = document.getElementById('hourly-forecast');
    const dailyForecastEl = document.getElementById('daily-forecast');
    const weatherIconEl = document.getElementById('weatherIcon');
    const summaryEl = document.getElementById('summary');
    const loaderEl = document.getElementById('loader');
    const windEl = document.getElementById('wind');
    const humidityEl = document.getElementById('humidity');
    const pressureEl = document.getElementById('pressure');
    const uvEl = document.getElementById('uv');
    const visEl = document.getElementById('vis');
    const aqiEl = document.getElementById('aqi');
    const adviceEl = document.getElementById('advice');
    const canvas = document.getElementById('effects');
    const ctx = canvas.getContext('2d');

    let w = 0, h = 0;
    let effectUpdaterInterval = null;

    function resizeCanvas(){
      const dpr = window.devicePixelRatio || 1;
      w = appContainer.clientWidth;
      h = appContainer.clientHeight;
      canvas.width = Math.max(300, Math.floor(w * dpr));
      canvas.height = Math.max(200, Math.floor(h * dpr));
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(dpr, dpr);
    }
    window.addEventListener('resize', resizeCanvas);

    async function fetchWeather(q){
      try{
        loaderEl.style.display = 'block';
        searchBtn.textContent = '...';
        searchBtn.disabled = true;

        const url = `${BASE}?key=${API_KEY}&q=${encodeURIComponent(q)}&days=3&aqi=yes&alerts=no`;
        const res = await fetch(url);
        if(!res.ok) throw new Error(`City not found or network error (${res.status})`);
        const data = await res.json();
        
        if (effectUpdaterInterval) clearInterval(effectUpdaterInterval);
        
        if (!document.body.classList.contains('app-visible')) {
            document.body.classList.add('app-visible');
            welcomeScreen.classList.add('hidden');
            appContainer.classList.remove('hidden');
            panel.prepend(searchRow);
            setTimeout(resizeCanvas, 50);
        }
        
        renderWeather(data);
        startHourlyEffectUpdates(data);
      }catch(err){
        alert('Could not fetch weather. Please check the city name and your connection.');
        console.error(err);
      }finally{
        loaderEl.style.display = 'none';
        searchBtn.textContent = 'Search';
        searchBtn.disabled = false;
      }
    }

    function renderWeather(d){
      const { location, current, forecast } = d;
      locationEl.textContent = `${location.name}, ${location.region || location.country}`;
      updatedEl.textContent = `Updated: ${new Date(current.last_updated_epoch * 1000).toLocaleTimeString()}`;
      tempEl.textContent = `${Math.round(current.temp_c)}°C`;
      conditionEl.textContent = current.condition.text;
      feelsEl.textContent = `Feels like ${Math.round(current.feelslike_c)}°C`;

      summaryEl.textContent = `Today: ${forecast.forecastday[0].day.condition.text}. High ${Math.round(forecast.forecastday[0].day.maxtemp_c)}°C, Low ${Math.round(forecast.forecastday[0].day.mintemp_c)}°C.`;

      windEl.textContent = `${current.wind_kph} kph`;
      humidityEl.textContent = `${current.humidity}%`;
      pressureEl.textContent = `${current.pressure_mb} mb`;
      uvEl.textContent = `${current.uv}`;
      visEl.textContent = `${current.vis_km} km`;
      aqiEl.textContent = current.air_quality ? Math.round(current.air_quality.pm2_5) : 'N/A';

      renderHourlyForecast(forecast.forecastday[0].hour);
      renderDailyForecast(forecast.forecastday);

      const adv = [];
      if(current.uv > 6) adv.push('High UV index. Wear sunscreen.');
      if(current.wind_kph > 40) adv.push('Strong winds. Be careful outside.');
      if(current.temp_c <= 5) adv.push('It\'s cold. Wear warm layers.');
      if(current.temp_c >= 30) adv.push('Hot day. Stay hydrated.');
      if(current.condition.text.toLowerCase().includes('rain')) adv.push('Carry an umbrella.');
      adviceEl.textContent = adv.length ? adv.join(' ') : 'Enjoy your day!';

      updateIconAndInitialEffects(current);
    }

    function renderHourlyForecast(hours){
      const currentHour = new Date().getHours();
      hourlyForecastEl.innerHTML = '';
      const upcomingHours = hours.filter(h => new Date(h.time_epoch * 1000).getHours() >= currentHour);
      
      if (upcomingHours.length === 0) {
          hourlyForecastEl.innerHTML = `<div style="padding:10px; color:var(--muted); font-size: 14px;">No more hourly data available for today.</div>`;
          return;
      }

      upcomingHours.forEach(h => {
          const hour = new Date(h.time_epoch * 1000).toLocaleTimeString('en-US', { hour: 'numeric', hour12: true }).replace(' ', '');
          const el = document.createElement('div');
          el.className = 'day';
          el.innerHTML = `
              <div class="d">${hour}</div>
              <img src="https:${h.condition.icon}" alt="${h.condition.text}" width="40" height="40">
              <div style="font-weight:700;margin-top:6px">${Math.round(h.temp_c)}°C</div>`;
          hourlyForecastEl.appendChild(el);
      });
    }

    function renderDailyForecast(days) {
        dailyForecastEl.innerHTML = '';
        dailyForecastEl.className = 'daily-forecast-container';
        days.forEach(fd => {
            const dayName = new Date(fd.date).toLocaleDateString(undefined, { weekday: 'long' });
            const el = document.createElement('div');
            el.className = 'day-row';
            el.innerHTML = `
                <div class="day-info">
                    <div class="day-name">${dayName}</div>
                    <img src="https:${fd.day.condition.icon}" alt="${fd.day.condition.text}" width="36" height="36">
                </div>
                <div class="day-temp">${Math.round(fd.day.maxtemp_c)}° / ${Math.round(fd.day.mintemp_c)}°C</div>`;
            dailyForecastEl.appendChild(el);
        });
    }
    
    function createEffectFlags(weatherData){
        const cond = weatherData.condition.text.toLowerCase();
        const code = weatherData.condition.code;
        const flags = { rain:false, snow:false, wind:false, cloud:false };
        
        if(cond.includes('rain') || cond.includes('drizzle')) flags.rain = true;
        if(cond.includes('snow') || cond.includes('sleet') || cond.includes('blizzard')) flags.snow = true;
        if(cond.includes('thunder')) flags.rain = true;
        if(weatherData.wind_kph > 25) flags.wind = true;
        if([1003,1006,1009].includes(code) || cond.includes('mist') || cond.includes('fog') || cond.includes('overcast')) flags.cloud = true;

        return flags;
    }

    function updateIconAndInitialEffects(currentWeather){
      weatherIconEl.innerHTML = `<img src="https:${currentWeather.condition.icon}" alt="${currentWeather.condition.text}" width="74" height="74">`;
      const flags = createEffectFlags(currentWeather);
      startEffects(flags);
    }
    
    function startHourlyEffectUpdates(data) {
        effectUpdaterInterval = setInterval(() => {
            const now = new Date();
            const currentHour = now.getHours();
            const hourlyData = data.forecast.forecastday[0].hour.find(h => new Date(h.time_epoch * 1000).getHours() === currentHour);

            let flags;
            if (hourlyData) {
                flags = createEffectFlags(hourlyData);
            } else {
                flags = createEffectFlags(data.current); // Fallback
            }
            startEffects(flags);
        }, 300000); // Update effects every 5 minutes
    }

    let particles = [];
    let raf;

    function startEffects(flags){
      cancelAnimationFrame(raf);
      particles = [];
      resizeCanvas();
      const windSpeed = flags.wind ? 1.6 : 0.25;

      if(flags.rain) for(let i=0;i<160;i++) particles.push(new Drop(windSpeed));
      if(flags.snow) for(let i=0;i<120;i++) particles.push(new Snow(windSpeed));
      if(flags.cloud) for(let i=0;i<18;i++) particles.push(new CloudParticle());

      if(particles.length) animLoop();
      else ctx.clearRect(0,0,w,h);
    }

    function Particle(){ this.x = Math.random() * w; this.y = Math.random() * h; }
    function Drop(wind){ this.base = new Particle(); this.len = 6 + Math.random()*14; this.vy = 4 + Math.random()*6; this.vx = wind * (1 + Math.random()); this.draw = function(){ ctx.beginPath(); ctx.moveTo(this.base.x, this.base.y); ctx.lineTo(this.base.x + this.vx, this.base.y + this.len); ctx.stroke(); } }
    function Snow(wind){ this.base = new Particle(); this.r = 1 + Math.random()*3; this.vy = 0.3 + Math.random()*1.1; this.vx = wind * (Math.random() - 0.5); this.draw = function(){ ctx.beginPath(); ctx.arc(this.base.x, this.base.y, this.r, 0, Math.PI*2); ctx.fill(); } }
    function CloudParticle(){ this.base = new Particle(); this.base.y = h; this.r = 18 + Math.random()*30; this.vy = -(0.06 + Math.random()*0.28); this.vx = Math.random()*0.3 - 0.15; this.alpha = 0.02 + Math.random()*0.06; this.draw = function(){ ctx.fillStyle = `rgba(255,255,255,${this.alpha})`; ctx.beginPath(); ctx.arc(this.base.x, this.base.y, this.r, 0, Math.PI*2); ctx.fill(); } }

    function animLoop(){
      ctx.clearRect(0,0,w,h);
      ctx.lineWidth = 1.2;
      ctx.strokeStyle = 'rgba(255,255,255,0.22)';
      ctx.fillStyle = 'rgba(255,255,255,0.45)';
      for(let p of particles){
        if(p.base){
          p.base.x += (p.vx || 0);
          p.base.y += (p.vy || 0);
          if(p instanceof CloudParticle){ if(p.base.y + p.r < -20){ p.base.y = h + p.r + Math.random()*40; p.base.x = Math.random() * w; } }
          else { if(p.base.y > h + 30){ p.base.x = Math.random() * w; p.base.y = -40 - Math.random()*100; } }
          if(p.base.x > w + 40) p.base.x = -40;
          if(p.base.x < -40) p.base.x = w + 40;
        }
        p.draw();
      }
      raf = requestAnimationFrame(animLoop);
    }

    function handleSearch() {
        const v = cityInput.value.trim();
        if(v) fetchWeather(v);
        else alert('Please enter a city name.');
    }

    searchBtn.addEventListener('click', handleSearch);
    cityInput.addEventListener('keypress', (e)=>{ if(e.key === 'Enter') handleSearch(); });

    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) cancelAnimationFrame(raf); else if(particles.length) animLoop(); });
    document.querySelector('.app').addEventListener('dblclick', ()=>cityInput.focus());

  </script>
</body>
</html>