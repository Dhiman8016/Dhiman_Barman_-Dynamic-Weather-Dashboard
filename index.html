<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dynamic Weather Dashboard</title>
  <style>
    /* ---------- Theme & Reset ---------- */
    :root{
      --bg-1:#071021;
      --bg-2:#0b1830;
      --card: rgba(20,30,48,0.68);
      --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.06);
      --accent: #ffc300;
      --muted: rgba(255,255,255,0.78);
      --radius: 16px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html{font-size:16px}
    body{
      min-height:100vh;
      background:linear-gradient(180deg,var(--bg-1) 0%, var(--bg-2) 70%);
      color:white;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      overflow:auto;
    }

    /* ---------- App Shell ---------- */
    .app{
      width:100%;
      max-width:1200px;
      height:92vh;
      max-height:820px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:18px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      box-shadow:0 14px 48px rgba(0,0,0,0.6);
      backdrop-filter: blur(10px);
      position:relative;
      overflow:hidden;
    }

    /* ---------- Left Panel ---------- */
    .panel{
      background:var(--card);
      padding:18px;
      border-radius:12px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
    }
    .search-row{display:flex;gap:8px;align-items:center}
    input[type=text]{
      flex:1;padding:12px;border-radius:10px;border:1px solid var(--glass);
      background:rgba(255,255,255,0.03);color:var(--muted);outline:none;font-size:14px;
    }
    input[type=text]:focus{border-color:var(--accent)}
    button{
      border:none;cursor:pointer;border-radius:10px;padding:10px 12px;font-weight:600;
      display:inline-flex;align-items:center;justify-content:center;
    }
    #searchBtn{background:var(--accent);color:#071021}
    button:active{transform:scale(0.97)}
    .location{font-size:18px;font-weight:700}
    .updated{font-size:12px;color:rgba(255,255,255,0.6);margin-top:4px}

    .current-weather{display:flex;gap:12px;align-items:center;margin-top:6px}
    .icon{width:74px;height:74px;display:flex;align-items:center;justify-content:center}
    .big-temp{font-size:56px;font-weight:800;line-height:1}
    .conds{font-size:15px;color:var(--muted)}
    .small-stat{font-size:13px;color:rgba(255,255,255,0.85)}

    .forecast{
      display:flex;gap:10px;margin-top:12px;padding-bottom:8px;overflow-x:auto;
      scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch;
    }
    .forecast .day{
      flex:0 0 auto;min-width:84px;background:var(--glass-2);padding:10px;border-radius:10px;
      text-align:center;scroll-snap-align:start;
    }
    .forecast .day .d{font-weight:700;margin-bottom:6px}

    /* ---------- Right Panel ---------- */
    .main{
      padding:18px;border-radius:12px;display:flex;flex-direction:column;overflow:auto;
      min-height:0;
    }
    .header-row{display:flex;justify-content:space-between;align-items:center}
    h2{font-size:20px}
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap:12px;
      margin-top:12px;
    }
    .metric{
      background:var(--glass);padding:12px;border-radius:10px;text-align:center;
    }
    .metric .num{font-size:20px;font-weight:700}
    .metric .lab{font-size:12px;color:var(--muted);margin-top:6px}

    #effects{position:absolute;inset:0;pointer-events:none;border-radius:var(--radius)}
    .flash{position:absolute;inset:0;background:#fff;opacity:0;pointer-events:none;z-index:10}

    .loader{width:22px;height:22px;border-radius:50%;
      border:3px solid rgba(255,255,255,0.12);border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    @media (max-width:1024px){
      .app{grid-template-columns: 1fr; height:auto; max-height:none}
      .panel{border-radius:0}
      .main{border-radius:0}
    }
    @media (max-width:600px){
      body{padding:0}
      .app{height:auto;border-radius:0}
      .panel{padding:14px}
      .main{padding:14px}
      .big-temp{font-size:44px}
      .search-row input[type=text]{padding:10px;font-size:14px}
      #searchBtn{padding:8px}
      .grid{grid-template-columns:repeat(2,1fr)}
      .forecast .day{min-width:72px}
    }

    @media (prefers-reduced-motion: reduce){
      *{animation:none!important;transition:none!important}
    }

    .forecast::-webkit-scrollbar, .main::-webkit-scrollbar{height:8px;width:8px}
    .forecast::-webkit-scrollbar-thumb, .main::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.06);border-radius:20px}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Dynamic Weather Dashboard">
    <canvas id="effects" aria-hidden="true"></canvas>
    <div class="panel" aria-live="polite">
      <div class="search-row">
        <!-- Updated placeholder text -->
        <input id="cityInput" type="text" placeholder="Search City" aria-label="City input" />
        <button id="searchBtn" title="Search">Search</button>
      </div>

      <div id="weather-content">
        <div class="location" id="location">—</div>
        <div class="updated" id="updated">No data yet</div>

        <div class="current-weather" role="region" aria-label="Current weather">
          <div class="icon" id="weatherIcon" aria-hidden="true"></div>
          <div>
            <div class="big-temp" id="temp">--°C</div>
            <div class="conds" id="condition">—</div>
            <div class="small-stat" id="feels">Feels like: —</div>
          </div>
        </div>

        <div class="forecast" id="forecast" aria-label="3 day forecast"></div>
      </div>

      <div class="flash" id="flash" aria-hidden="true"></div>
    </div>

    <div class="main">
      <div class="header-row">
        <h2>Details</h2>
        <div id="loader" class="loader" style="display:none" aria-hidden="true"></div>
      </div>

      <p id="summary" style="color:var(--muted);margin-top:8px">Fetching your live weather...</p>

      <div class="grid" role="list" aria-label="Weather metrics" style="margin-top:12px">
        <div class="metric" role="listitem"><div class="num" id="wind">—</div><div class="lab">Wind</div></div>
        <div class="metric" role="listitem"><div class="num" id="humidity">—</div><div class="lab">Humidity</div></div>
        <div class="metric" role="listitem"><div class="num" id="pressure">—</div><div class="lab">Pressure</div></div>
        <div class="metric" role="listitem"><div class="num" id="uv">—</div><div class="lab">UV Index</div></div>
        <div class="metric" role="listitem"><div class="num" id="vis">—</div><div class="lab">Visibility</div></div>
        <div class="metric" role="listitem"><div class="num" id="aqi">—</div><div class="lab">AQI (PM2.5)</div></div>
      </div>

      <div style="margin-top:14px">
        <strong>Tips:</strong>
        <ul style="margin-top:6px;color:var(--muted);padding-left:18px">
          <li id="advice">—</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    const API_KEY = 'c6015299029641ef806133911251909';
    const BASE = 'https://api.weatherapi.com/v1/forecast.json';

    const cityInput = document.getElementById('cityInput');
    const searchBtn = document.getElementById('searchBtn');
    const locationEl = document.getElementById('location');
    const updatedEl = document.getElementById('updated');
    const tempEl = document.getElementById('temp');
    const conditionEl = document.getElementById('condition');
    const feelsEl = document.getElementById('feels');
    const forecastEl = document.getElementById('forecast');
    const weatherIconEl = document.getElementById('weatherIcon');
    const summaryEl = document.getElementById('summary');
    const loaderEl = document.getElementById('loader');
    const windEl = document.getElementById('wind');
    const humidityEl = document.getElementById('humidity');
    const pressureEl = document.getElementById('pressure');
    const uvEl = document.getElementById('uv');
    const visEl = document.getElementById('vis');
    const aqiEl = document.getElementById('aqi');
    const adviceEl = document.getElementById('advice');
    const flashEl = document.getElementById('flash');
    const canvas = document.getElementById('effects');
    const ctx = canvas.getContext('2d');

    let w = 0, h = 0;
    function resizeCanvas(){
      const dpr = window.devicePixelRatio || 1;
      const app = document.querySelector('.app');
      w = app.clientWidth;
      h = app.clientHeight;
      canvas.width = Math.max(300, Math.floor(w * dpr));
      canvas.height = Math.max(200, Math.floor(h * dpr));
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(dpr, dpr);
    }
    window.addEventListener('resize', resizeCanvas);

    async function fetchWeather(q){
      try{
        loaderEl.style.display = 'block';
        const url = `${BASE}?key=${API_KEY}&q=${encodeURIComponent(q)}&days=3&aqi=yes&alerts=no`;
        const res = await fetch(url);
        if(!res.ok) throw new Error('Network response not ok');
        const data = await res.json();
        renderWeather(data);
      }catch(err){
        alert('Could not fetch weather. Please check your connection.');
        console.error(err);
      }finally{
        loaderEl.style.display = 'none';
      }
    }

    function renderWeather(d){
      const { location, current, forecast } = d;
      locationEl.textContent = `${location.name}, ${location.region || location.country}`;
      updatedEl.textContent = `Updated: ${current.last_updated}`;
      tempEl.textContent = `${Math.round(current.temp_c)}°C`;
      conditionEl.textContent = current.condition.text;
      feelsEl.textContent = `Feels like ${Math.round(current.feelslike_c)}°C`;

      summaryEl.textContent = `Today: ${forecast.forecastday[0].day.condition.text}. High ${Math.round(forecast.forecastday[0].day.maxtemp_c)}°C, Low ${Math.round(forecast.forecastday[0].day.mintemp_c)}°C.`;

      windEl.textContent = `${current.wind_kph} kph`;
      humidityEl.textContent = `${current.humidity}%`;
      pressureEl.textContent = `${current.pressure_mb} mb`;
      uvEl.textContent = `${current.uv}`;
      visEl.textContent = `${current.vis_km} km`;
      aqiEl.textContent = current.air_quality ? Math.round(current.air_quality.pm2_5) : 'N/A';

      forecastEl.innerHTML = '';
      forecast.forecastday.forEach(fd=>{
        const dayName = new Date(fd.date).toLocaleDateString(undefined,{weekday:'short'});
        const el = document.createElement('div');
        el.className = 'day';
        el.innerHTML = `<div class="d">${dayName}</div>
                        <img src="https:${fd.day.condition.icon}" alt="${fd.day.condition.text}" width="40" height="40">
                        <div style="font-weight:700;margin-top:6px">${Math.round(fd.day.avgtemp_c)}°C</div>`;
        forecastEl.appendChild(el);
      });

      const adv = [];
      if(current.uv > 6) adv.push('High UV index. Wear sunscreen.');
      if(current.wind_kph > 40) adv.push('Strong winds. Be careful outside.');
      if(current.temp_c <= 5) adv.push('It\'s cold. Wear warm layers.');
      if(current.temp_c >= 30) adv.push('Hot day. Stay hydrated.');
      if(current.condition.text.toLowerCase().includes('rain')) adv.push('Carry an umbrella.');
      adviceEl.textContent = adv.length ? adv.join(' ') : 'Enjoy your day!';

      setIconAndEffects(d);
    }

    function setIconAndEffects(data){
      const cond = data.current.condition.text.toLowerCase();
      const code = data.current.condition.code;
      weatherIconEl.innerHTML = `<img src="https:${data.current.condition.icon}" alt="${cond}">`;

      const flags = { rain:false, snow:false, wind:false, lightning:false, cloud:false };
      if(cond.includes('rain') || cond.includes('drizzle')) flags.rain = true;
      if(cond.includes('snow') || cond.includes('sleet') || cond.includes('blizzard')) flags.snow = true;
      if(cond.includes('thunder')) { flags.lightning = true; flags.rain = true; }
      if(data.current.wind_kph > 25) flags.wind = true;
      if([1003,1006,1009].includes(code) || cond.includes('mist') || cond.includes('fog') || cond.includes('overcast')) flags.cloud = true;

      startEffects(flags);
    }

    let particles = [];
    let raf;
    let lightningTimer = null;

    function startEffects(flags){
      cancelAnimationFrame(raf);
      particles = [];
      resizeCanvas();
      const windSpeed = flags.wind ? 1.6 : 0.25;

      if(flags.rain) for(let i=0;i<160;i++) particles.push(new Drop(windSpeed));
      if(flags.snow) for(let i=0;i<120;i++) particles.push(new Snow(windSpeed));
      if(flags.cloud) for(let i=0;i<18;i++) particles.push(new CloudParticle());
      if(flags.lightning) startLightning(); else stopLightning();

      if(particles.length) animLoop();
      else ctx.clearRect(0,0,w,h);
    }

    function Particle(){ this.x = Math.random() * w; this.y = Math.random() * h; }
    function Drop(wind){ this.base = new Particle(); this.len = 6 + Math.random()*14; this.vy = 4 + Math.random()*6; this.vx = wind * (1 + Math.random()); this.draw = function(){ ctx.beginPath(); ctx.moveTo(this.base.x, this.base.y); ctx.lineTo(this.base.x + this.vx, this.base.y + this.len); ctx.stroke(); } }
    function Snow(wind){ this.base = new Particle(); this.r = 1 + Math.random()*3; this.vy = 0.3 + Math.random()*1.1; this.vx = wind * (Math.random() - 0.5); this.draw = function(){ ctx.beginPath(); ctx.arc(this.base.x, this.base.y, this.r, 0, Math.PI*2); ctx.fill(); } }
    function CloudParticle(){ this.base = new Particle(); this.base.y = h; this.r = 18 + Math.random()*30; this.vy = -(0.06 + Math.random()*0.28); this.vx = Math.random()*0.3 - 0.15; this.alpha = 0.02 + Math.random()*0.06; this.draw = function(){ ctx.fillStyle = `rgba(255,255,255,${this.alpha})`; ctx.beginPath(); ctx.arc(this.base.x, this.base.y, this.r, 0, Math.PI*2); ctx.fill(); } }

    function animLoop(){
      ctx.clearRect(0,0,w,h);
      ctx.lineWidth = 1.2;
      ctx.strokeStyle = 'rgba(255,255,255,0.22)';
      ctx.fillStyle = 'rgba(255,255,255,0.45)';
      for(let p of particles){
        if(p.base){
          p.base.x += (p.vx || 0);
          p.base.y += (p.vy || 0);
          if(p instanceof CloudParticle){ if(p.base.y + p.r < -20){ p.base.y = h + p.r + Math.random()*40; p.base.x = Math.random() * w; } }
          else { if(p.base.y > h + 30){ p.base.x = Math.random() * w; p.base.y = -40 - Math.random()*100; } }
          if(p.base.x > w + 40) p.base.x = -40;
          if(p.base.x < -40) p.base.x = w + 40;
        }
        p.draw();
      }
      raf = requestAnimationFrame(animLoop);
    }

    function startLightning(){
      if(lightningTimer) return;
      lightningTimer = setInterval(()=>{
        flashEl.style.transition = 'opacity 0.05s linear';
        flashEl.style.opacity = 0.9;
        setTimeout(()=>{ flashEl.style.transition = 'opacity 0.6s linear'; flashEl.style.opacity = 0; }, 100 + Math.random()*200);
      }, 3500 + Math.random()*5000);
    }
    function stopLightning(){ if(lightningTimer){ clearInterval(lightningTimer); lightningTimer = null; flashEl.style.opacity = 0; } }

    searchBtn.addEventListener('click', ()=>{ const v = cityInput.value.trim(); if(v) fetchWeather(v); else alert('Please enter a city name.'); });
    cityInput.addEventListener('keypress', (e)=>{ if(e.key === 'Enter') searchBtn.click(); });

    // Updated: only fetch user's current location, no fallback to London
    document.addEventListener('DOMContentLoaded', ()=>{
      resizeCanvas();
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          const q = `${pos.coords.latitude},${pos.coords.longitude}`;
          fetchWeather(q);
        }, ()=>{ alert('Location access denied. Please search manually.'); });
      } else {
        alert('Geolocation not supported. Please search manually.');
      }
      setTimeout(resizeCanvas, 500);
    });

    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) cancelAnimationFrame(raf); else if(particles.length) animLoop(); });
    document.querySelector('.app').addEventListener('dblclick', ()=>cityInput.focus());
  </script>
</body>
</html>
